<?xml version="1.0" encoding="UTF-8"?>
<!-- Created with Jaspersoft Studio version 6.1.0.final using JasperReports Library version 6.1.0  -->
<!-- 2015-06-12T09:20:34 -->
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="absences_élémentaire" pageWidth="340" pageHeight="802" columnWidth="340" leftMargin="0" rightMargin="0" topMargin="0" bottomMargin="0" uuid="a0e98085-9fb3-49f3-8e7f-860cd364d74f">
	<property name="com.jaspersoft.studio.data.defaultdataadapter" value="CSCFN TRIL"/>
	<style name="Row">
		<conditionalStyle>
			<conditionExpression><![CDATA[(new Boolean( $V{REPORT_COUNT}.intValue() % 2 == 0 ))]]></conditionExpression>
			<style mode="Opaque" backcolor="#E8E8E8"/>
		</conditionalStyle>
	</style>
	<parameter name="ACCOUNT_ID" class="java.lang.String"/>
	<queryString language="SQL">
		<![CDATA[SELECT  SCHOOL_YEAR, MNTH, SUM(CASE WHEN ATTENDANCE_CODE = 'L' THEN 1 END) as L, 
           SUM(CASE WHEN ATTENDANCE_CODE = 'A' 
                    AND SCHOOL_CODE NOT IN ('CDJ') 
                    THEN 1/2                  --ÉCOLES ÉLÉMENTAIRES QUI NE SONT PAS CDJ PRENNENT LES ABSENCES À CHAQUE (2) PÉRIODE
                WHEN ATTENDANCE_CODE = 'A' 
                    AND SCHOOL_CODE IN ('CDJ') 
                    AND CALENDAR_DATE < TO_DATE('30/06/2012', 'DD/MM/YYYY') 
                    THEN 1/2                  --AVANT LE CHANGEMENT DES PÉRIODE À CDJ, EN 2012, CDJ PRENNAIT LES ABSENCES À CHAQUE (2) PÉRIODE
                WHEN ATTENDANCE_CODE = 'A'
                    AND SCHOOL_CODE IN ('CDJ')
                    AND CALENDAR_DATE > TO_DATE('30/06/2012', 'DD/MM/YYYY') 
                    THEN ROUND(1/6, 2)      --APRÈS LE CHANGEMENT DES PÉRIODES À CDJ, EN 2012, CDJ PRENNENT MAINTENT L'ABSENCE À CHAQUE (6) PÉRIODE
           END) as A
           
 FROM (SELECT SCHOOL_YEAR, SCHOOL_CODE, 
        CALENDAR_DATE,
        TO_CHAR(CALENDAR_DATE, 'mon') "MNTH", --Conversion de la date de l'absence à un mois
        ATTENDANCE_CODE
           
FROM PERIOD_ATTENDANCE

WHERE PERSON_ID = $P{ACCOUNT_ID} --Paramêtre dans Jaspersoft Studio

AND SCHOOL_CODE NOT IN ('ESF', 'ESA', 'ESE')  --On compte seulement les absences prises durant le séjour élémentaire
AND ATTENDANCE_CODE NOT IN ('N', 'E', 'G') --On ne compte pas les absences "Justifié". "Jour avec pas d'enseignement" ou "Intempéries"
AND UPPER(SCHOOL_PERIOD) NOT IN ('DÎNER', 'DINER', 'ACCEUIL', 'ACC.') --On ne compte pas les absences prises durant le dîner, ou pendant l'acceuil/foyer)


)
GROUP BY SCHOOL_YEAR, SCHOOL_CODE, ATTENDANCE_CODE, MNTH
ORDER BY school_year, MNTH DESC]]>
	</queryString>
	<field name="SCHOOL_YEAR" class="java.lang.String"/>
	<field name="MNTH" class="java.lang.String"/>
	<field name="L" class="java.math.BigDecimal"/>
	<field name="A" class="java.math.BigDecimal"/>
	<background>
		<band splitType="Stretch"/>
	</background>
	<columnHeader>
		<band height="80" splitType="Stretch">
			<staticText>
				<reportElement x="0" y="20" width="340" height="20" uuid="5040ed61-e3da-4fa0-b6d4-d2d5c5d9a5b0"/>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<font fontName="Tahoma" size="14" isBold="true"/>
				</textElement>
				<text><![CDATA[Assiduité par mois - élémentaire]]></text>
			</staticText>
			<staticText>
				<reportElement x="50" y="50" width="90" height="30" uuid="de188702-2146-41b3-a1f4-b4e12fabcd74"/>
				<box>
					<topPen lineWidth="0.2"/>
					<leftPen lineWidth="0.2"/>
					<bottomPen lineWidth="0.2"/>
					<rightPen lineWidth="0.2"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" size="8"/>
				</textElement>
				<text><![CDATA[MNTH]]></text>
			</staticText>
			<staticText>
				<reportElement x="240" y="50" width="100" height="30" uuid="c9e9ad23-bd4c-4103-8e3c-89816b5a74e1"/>
				<box>
					<topPen lineWidth="0.2"/>
					<leftPen lineWidth="0.2"/>
					<bottomPen lineWidth="0.2"/>
					<rightPen lineWidth="0.2"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" size="8"/>
				</textElement>
				<text><![CDATA[A]]></text>
			</staticText>
			<staticText>
				<reportElement x="140" y="50" width="100" height="30" uuid="7d0d2ad9-52ee-4d29-b0b6-bb4d2ae188a5"/>
				<box>
					<topPen lineWidth="0.2"/>
					<leftPen lineWidth="0.2"/>
					<bottomPen lineWidth="0.2"/>
					<rightPen lineWidth="0.2"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" size="8"/>
				</textElement>
				<text><![CDATA[L]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="20" splitType="Stretch">
			<textField isBlankWhenNull="true">
				<reportElement style="Row" x="0" y="0" width="50" height="20" uuid="4c5feabe-7351-48b7-b560-922fb6f40af3"/>
				<box>
					<topPen lineWidth="0.2"/>
					<leftPen lineWidth="0.2"/>
					<bottomPen lineWidth="0.2"/>
					<rightPen lineWidth="0.2"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{SCHOOL_YEAR}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="140" y="0" width="100" height="20" uuid="68c5ea90-e276-4b78-bc55-cc7784e1a9b0"/>
				<box>
					<topPen lineWidth="0.1" lineColor="#A3A3A3"/>
					<leftPen lineWidth="0.1" lineColor="#A3A3A3"/>
					<bottomPen lineWidth="0.1" lineColor="#A3A3A3"/>
					<rightPen lineWidth="0.1" lineColor="#A3A3A3"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{L}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="240" y="0" width="100" height="20" uuid="2bfb6986-7c8d-48b4-8293-be666663f3ef"/>
				<box>
					<topPen lineWidth="0.1" lineColor="#A3A3A3"/>
					<leftPen lineWidth="0.1" lineColor="#A3A3A3"/>
					<bottomPen lineWidth="0.1" lineColor="#A3A3A3"/>
					<rightPen lineWidth="0.1" lineColor="#A3A3A3"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{A}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="50" y="0" width="90" height="20" uuid="28128864-7940-43a7-a615-174bf3ad1294"/>
				<box>
					<topPen lineWidth="0.1" lineColor="#A3A3A3"/>
					<leftPen lineWidth="0.1" lineColor="#A3A3A3"/>
					<bottomPen lineWidth="0.1" lineColor="#A3A3A3"/>
					<rightPen lineWidth="0.1" lineColor="#A3A3A3"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Tahoma" size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{MNTH}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<pageFooter>
		<band height="40">
			<staticText>
				<reportElement x="0" y="10" width="270" height="30" uuid="6c088eb5-741e-4114-84a5-daccc618c4bb"/>
				<textElement textAlignment="Left">
					<font fontName="Tahoma" size="8"/>
				</textElement>
				<text><![CDATA[À noter qu'un 1 est égale à une pleine journée scolaire et que les décimales sont une absence par période manquée.]]></text>
			</staticText>
		</band>
	</pageFooter>
</jasperReport>
